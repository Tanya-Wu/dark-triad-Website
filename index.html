<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 修改了 viewport 设置，增加了 maximum-scale=1.0, user-scalable=no 来禁止移动端缩放 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>马基雅维利黑暗三角人格测试 - 疯狂动物城版</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.staticfile.org/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap');
        
        /* 添加了 touch-action: manipulation 禁止双击缩放，并防止 iOS 文本自动调整 */
        html {
            touch-action: manipulation; 
            -webkit-text-size-adjust: 100%;
        }

        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            /* 禁止移动端点击高亮背景色 */
            -webkit-tap-highlight-color: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { width: 0; } to { width: 100%; } }

        /* Card Hover Effect */
        .hover-card { transition: all 0.3s ease; }
        .hover-card:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 selection:bg-purple-200 min-h-screen">

    <!-- Watermark: Subtle & Fixed -->
    <div class="fixed bottom-4 right-4 z-50 pointer-events-none text-gray-400/50 text-xs md:text-sm font-bold select-none">
        小红书-心灵栖息树原创 侵权必究
    </div>

    <!-- Main App Container -->
    <div id="app" class="relative z-10">
        <!-- Content injected by JS -->
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA ---
        const TRAITS = {
            GREED: '贪婪', EGOISM: '利己主义', MALICE: '恶毒倾向', SELF_CENTRISM: '自我为中心',
            SADISM: '施虐倾向', PSYCHOPATHY: '精神变态', ENTITLEMENT: '心理权利', NARCISSISM: '自恋', MORAL_DISENGAGEMENT: '道德推脱'
        };

        const QUESTIONS = [
            // Greed
            { text: "为了赚更多的钱，通过捷径办事是可以接受的。", trait: 'GREED' },
            { text: "无论我拥有多少，我总是想要更多。", trait: 'GREED' },
            { text: "在这个世界上，金钱比人际关系更重要。", trait: 'GREED' },
            { text: "如果能让我致富，我不介意稍微违反规则。", trait: 'GREED' },
            { text: "看到别人拥有我没有的东西，我会感到非常不舒服。", trait: 'GREED' },
            { text: "即便生活富足，我也很难感到满足。", trait: 'GREED' },
            { text: "我认为展示财富是成功的标志。", trait: 'GREED' },
            // Egoism
            { text: "如果这对我没有好处，我就不会去做。", trait: 'EGOISM' },
            { text: "只要我能成功，别人的损失与我无关。", trait: 'EGOISM' },
            { text: "在困难的情况下，我首先考虑保护自己。", trait: 'EGOISM' },
            { text: "帮助别人通常是在浪费时间。", trait: 'EGOISM' },
            { text: "人们通过利用他人来获得成功是正常的。", trait: 'EGOISM' },
            { text: "我很少为了集体的利益而牺牲自己的利益。", trait: 'EGOISM' },
            // Malice
            { text: "看到讨厌的人失败，我会感到一丝快感。", trait: 'MALICE' },
            { text: "如果有人伤害了我，我一定会报复。", trait: 'MALICE' },
            { text: "有时候我只是想让事情变得混乱，看看会发生什么。", trait: 'MALICE' },
            { text: "我喜欢在谈话中暗中刺痛别人。", trait: 'MALICE' },
            { text: "即使对我没有直接好处，我也可能给不喜欢的人使绊子。", trait: 'MALICE' },
            { text: "我不介意在背后说别人的坏话。", trait: 'MALICE' },
            // Self-centrism
            { text: "我经常打断别人的话，因为我的观点更重要。", trait: 'SELF_CENTRISM' },
            { text: "我很难从别人的角度看问题。", trait: 'SELF_CENTRISM' },
            { text: "事情如果不按我的方式发展，我会很生气。", trait: 'SELF_CENTRISM' },
            { text: "我是我社交圈子的核心。", trait: 'SELF_CENTRISM' },
            { text: "别人的问题通常都很无聊。", trait: 'SELF_CENTRISM' },
            { text: "我习惯于让别人适应我的计划。", trait: 'SELF_CENTRISM' },
            { text: "我认为我的经历比大多数人的更独特。", trait: 'SELF_CENTRISM' },
            // Sadism
            { text: "在游戏中羞辱对手让我感到兴奋。", trait: 'SADISM' },
            { text: "看到别人身体疼痛或情绪崩溃的视频，我并不反感。", trait: 'SADISM' },
            { text: "有时候我会故意说些伤人的话。", trait: 'SADISM' },
            { text: "支配和控制别人让我感觉良好。", trait: 'SADISM' },
            { text: "我喜欢看恐怖片中角色受折磨的情节。", trait: 'SADISM' },
            { text: "如果我有权力，我会让那些我不喜欢的人受苦。", trait: 'SADISM' },
            // Psychopathy
            { text: "我很少感到内疚或悔恨。", trait: 'PSYCHOPATHY' },
            { text: "我经常在各种场合撒谎以达到目的。", trait: 'PSYCHOPATHY' },
            { text: "我很难理解为什么人们会因为电影情节而哭泣。", trait: 'PSYCHOPATHY' },
            { text: "我也许应该更关心别人，但我做不到。", trait: 'PSYCHOPATHY' },
            { text: "如果后果不严重，各种冒险行为我都愿意尝试。", trait: 'PSYCHOPATHY' },
            { text: "人们说我很冷漠，但这只是理性。", trait: 'PSYCHOPATHY' },
            { text: "只要能逃脱惩罚，道德并不是束缚。", trait: 'PSYCHOPATHY' },
            // Entitlement
            { text: "我理应得到比别人更好的待遇。", trait: 'ENTITLEMENT' },
            { text: "我不应该像普通人那样排队等待。", trait: 'ENTITLEMENT' },
            { text: "如果你不能给我想要的，那是你的无能。", trait: 'ENTITLEMENT' },
            { text: "我生来就注定要成为领导者。", trait: 'ENTITLEMENT' },
            { text: "我很讨厌别人告诉我该做什么。", trait: 'ENTITLEMENT' },
            { text: "我的时间比别人的时间更有价值。", trait: 'ENTITLEMENT' },
            { text: "我认为我应该自然而然地获得优待。", trait: 'ENTITLEMENT' },
            // Narcissism
            { text: "我喜欢照镜子欣赏自己。", trait: 'NARCISSISM' },
            { text: "我渴望得到别人的赞赏和关注。", trait: 'NARCISSISM' },
            { text: "我认为大多数人都比不上我。", trait: 'NARCISSISM' },
            { text: "我很容易在人群中脱颖而出。", trait: 'NARCISSISM' },
            { text: "向别人展示我的成就是很重要的。", trait: 'NARCISSISM' },
            { text: "我经常幻想自己拥有无限的权力或美貌。", trait: 'NARCISSISM' },
            { text: "我希望人们能崇拜我。", trait: 'NARCISSISM' },
            // Moral Disengagement
            { text: "只要目的是好的，手段不重要。", trait: 'MORAL_DISENGAGEMENT' },
            { text: "比起那些大公司做的事，我做这点坏事不算什么。", trait: 'MORAL_DISENGAGEMENT' },
            { text: "如果别人太蠢被骗了，那是他们自己的错。", trait: 'MORAL_DISENGAGEMENT' },
            { text: "规则只是给那些不敢打破它们的人制定的。", trait: 'MORAL_DISENGAGEMENT' },
            { text: "为了生存，有时候必须不择手段。", trait: 'MORAL_DISENGAGEMENT' },
            { text: "人们总是把道德看得太重了。", trait: 'MORAL_DISENGAGEMENT' },
            { text: "如果上级命令我做坏事，那不是我的责任。", trait: 'MORAL_DISENGAGEMENT' }
        ];

        // Extended Character Data with Analysis
        // SORTED BY DARKNESS: HIGH D (Darkest) -> LOW D (Kindest)
        // Range adjusted to 1.0 - 5.0 to ensure low scores (1.0) can match Judy/Gary.
        const CHARACTERS = [
            {
                name: "羊副市长 (Bellwether) - 披着羊皮的狼",
                minD: 4.5,
                desc: "表面是温顺实则心机深沉的幕后黑手。你像羊副市长一样，擅长利用被忽视的身份进行惊天布局，利用群体对立来夺取权力。",
                quote: "“作为猎物真是太可怕了，对吧？”",
                tags: ["#伪装大师", "#极致心机", "#复仇者"],
                light: "你拥有极强的隐忍能力和策划能力，能够为了一个目标蛰伏许久，精准抓住对手的弱点。",
                shadow: "过度的受害者心态让你合理化所有的恶行，在权力的游戏中逐渐迷失了底线。",
                strategy: "警惕因自卑而滋生的控制欲。你的智慧如果用于建设而非破坏，将无人能敌。"
            },
            {
                name: "宝伯特 (Bobber) - 渴望认同的野心家",
                minD: 4.1,
                desc: "林雪猁家族中极力想证明自己的小儿子。你阴险、多疑的背后，其实是一颗害怕被抛弃、害怕成为“异类”的脆弱之心。",
                quote: "“我不想不一样。”",
                tags: ["#病态自尊", "#家族边缘人", "#极端手段"],
                light: "你对他人的评价极其敏感，这让你具备了极强的察言观色能力和不甘平庸的进取心。",
                shadow: "因为太想融入而选择了错误的道路，你的阴险其实是过度防御的铠甲。",
                strategy: "真正的独特性不是原罪。接纳自己的“不一样”，你不需要通过伤害他人来获得存在感。"
            },
            {
                name: "大先生 (Mr. Big) - 秩序教父",
                minD: 3.7,
                desc: "虽然体型微小，但你像大先生一样拥有强大的气场。你是黑帮绅士，讲究原则、护短且极为重视家族荣誉，是秩序的建立者。",
                quote: "“我们是一家人，但不要挑战我的底线。”",
                tags: ["#家族至上", "#教父气场", "#恩怨分明"],
                light: "你天生具有领袖魅力，能够建立一套行之有效的规则，并庇护所有效忠于你的人。",
                shadow: "当权威受到挑战时，你会展现出雷霆手段，容易陷入刚愎自用的陷阱。",
                strategy: "继续维护你的圈子，但要注意区分“忠诚”和“盲从”，避免被周围的赞美蒙蔽。"
            },
            {
                name: "尼克 (Nick Wilde) - 魅力游侠",
                minD: 3.3,
                desc: "你是混世魔王，也是缺爱的小狐狸。你像尼克一样用狡猾伪装自己，看透世态炎凉但内心依然保留着对美好的向往。",
                quote: "“怎么？伤了你的小心脏？”",
                tags: ["#街头智慧", "#防御性伪装", "#痞帅"],
                light: "你拥有极高的情商和变通能力，能够利用规则的漏洞解决看似无解的难题。",
                shadow: "过度的防御机制让你很难交付真心，用玩世不恭来逃避深层的情感链接。",
                strategy: "你的同理心是你最强大的武器。尝试卸下面具，你会发现世界并不总是充满敌意。"
            },
            {
                name: "牛局长 (Chief Bogo) - 铁血守护者",
                minD: 2.9,
                desc: "典型的刀子嘴豆腐心。你像牛局长一样严肃、刻板，对外冷内热，虽然固执但拥有极强的责任感和护短属性。",
                quote: "“生活不是音乐剧，把这一套收起来！”",
                tags: ["#硬汉柔情", "#规则捍卫者", "#责任感Max"],
                light: "你是团队中最坚实的后盾，在危机时刻，你的存在就是安全感的代名词。",
                shadow: "有时过于迷信权威和经验，容易对新生事物产生偏见，显得不近人情。",
                strategy: "保持你的原则，但试着给“意外”留一点空间，也许会有意想不到的惊喜。"
            },
            {
                name: "狸宝 (Nibbles) - 热心万事通",
                minD: 2.5,
                desc: "你是湿地市场的“万事通”，像河狸狸宝一样古灵精怪、好奇心爆棚。你思维跳脱，热衷于探险和帮助别人。",
                quote: "“这事儿门儿清，包在我身上！”",
                tags: ["#好奇宝宝", "#行动力", "#古道热肠"],
                light: "你拥有无限的精力和求知欲，乐于助人的品质让你在人群中总是备受欢迎。",
                shadow: "有时过度的热情和“懂王”属性可能会显得有些聒噪，甚至好心办坏事。",
                strategy: "保持你的好奇心，但学会倾听他人的需求，你的帮助会变得更有价值。"
            },
            {
                name: "本杰明 (Clawhauser) - 乐天派警员",
                minD: 2.1,
                desc: "你是警察局的开心果，像本杰明一样乐观开朗、热爱美食和八卦。虽然没有猛兽的威严，但你的亲和力无人能敌。",
                quote: "“天哪！这甜甜圈也太好吃了！”",
                tags: ["#社交达人", "#享乐主义", "#温暖治愈"],
                light: "你的热情和友善是团队的粘合剂，能够轻易化解紧张的气氛，让人感到温暖。",
                shadow: "有时过于贪图安逸和逃避严肃话题，可能会让人觉得缺乏深度和危机感。",
                strategy: "继续散发你的快乐能量，它是对抗黑暗最有效的抗抑郁剂。"
            },
            {
                name: "闪电 (Flash) - 节奏掌控者",
                minD: 1.7,
                desc: "你像树懒闪电一样，拥有一种让人抓狂的从容。你用“慢”来对抗世界的“快”，不仅是一种生活态度，更是一种隐形的掌控力。",
                quote: "“哈……哈……哈……”",
                tags: ["#反差萌", "#被动攻击", "#自我节奏"],
                light: "在这个焦虑的时代，你拥有不被外界打扰的定力，专注于当下的每一个细节。",
                shadow: "你的“慢”有时是一种无声的反抗，可能会在无意中消磨掉他人的耐心和热情。",
                strategy: "利用你的节奏感去平复周围的焦虑，但要注意分寸，别让从容变成了拖延。"
            },
            {
                name: "盖瑞 (Gary) - 治愈系守护者",
                minD: 1.3,
                desc: "你是一条善良的蛇，自带“解药”的小天使。你随身携带解毒笔，在朱迪遇险时尽心守护，被家人深深爱着。",
                quote: "“家人永远不会把重担放在我一个人肩上，因为蛇没有肩膀。”",
                tags: ["#解毒天使", "#家族团宠", "#暖心蛇蛇"],
                light: "你拥有极强的责任感和治愈能力，你的存在证明了‘冷血动物’也可以拥有最热的心肠。",
                shadow: "你的善良让你总是优先考虑别人，在守护他人的时候，别忘了也要保护好自己。",
                strategy: "继续用你的温暖打破偏见，你的善良是你最坚硬的鳞片。"
            },
            {
                name: "朱迪 (Judy Hopps) - 光明骑士",
                minD: 0.0,
                desc: "你是绝对正能量的化身，像朱迪一样拥有永不放弃的内心。你相信世界可以更美好，并且愿意为此付诸行动。",
                quote: "“尝试让世界变得更美好。”",
                tags: ["#理想主义", "#绝对正义", "#破壁者"],
                light: "你的信念感极强，能够感染并带动周围的人一起向上，是真正的变革者。",
                shadow: "在面对复杂的灰度世界时，你可能显得过于天真，容易受到理想幻灭的打击。",
                strategy: "世界不仅仅是黑白的。保持初心的同时，学会理解和接纳人性的复杂。"
            }
        ];

        // --- ICONS ---
        const ICONS = {
            ghost: `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-900"><path d="M9 10h.01"/><path d="M15 10h.01"/><path d="M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"/></svg>`,
            brain: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>`,
            target: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
            shield: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>`,
            zap: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
            crown: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>`,
            scale: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>`,
            share: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>`,
            heartCrack: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="m12 13-3-3"/><path d="m12 13 3-3"/></svg>`,
            sun: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>`,
            moon: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>`,
            compass: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-600"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>`
        };

        // --- APP LOGIC ---
        let currentState = { step: 'intro', qIndex: 0, answers: [] };
        const app = document.getElementById('app');

        function renderIntro() {
            app.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen p-6 text-center max-w-2xl mx-auto fade-in">
                    <div class="bg-white/90 backdrop-blur-sm p-10 rounded-3xl shadow-2xl border-4 border-gray-900">
                        <div class="mb-6 flex justify-center">${ICONS.ghost}</div>
                        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4 tracking-tight">
                            马基雅维利<br/><span class="text-purple-700">黑暗三角人格测试</span>
                        </h1>
                        <div class="bg-purple-100 text-purple-900 px-4 py-2 rounded-full font-bold text-sm mb-6 inline-block">
                            ZOOTOPIA 2 特别版
                        </div>
                        <p class="text-gray-600 mb-8 leading-relaxed text-lg">
                            通过 <strong>60道深层心理题</strong>，揭示你内心深处的 D因子 (Dark Factor)。<br/>
                            <span class="text-sm text-gray-500 mt-2 block">不仅是测试，更是一份关于你如何在这个残酷世界生存的深度报告。</span>
                        </p>
                        
                        <div class="grid grid-cols-3 gap-4 mb-8 text-sm text-gray-500">
                            <div class="flex flex-col items-center">
                                <div class="mb-2 text-gray-800">${ICONS.brain}</div>
                                <span>光影解析</span>
                            </div>
                            <div class="flex flex-col items-center">
                                <div class="mb-2 text-gray-800">${ICONS.target}</div>
                                <span>人格雷达</span>
                            </div>
                            <div class="flex flex-col items-center">
                                <div class="mb-2 text-gray-800">${ICONS.shield}</div>
                                <span>生态位匹配</span>
                            </div>
                        </div>

                        <button onclick="startQuiz()" class="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-white transition-all duration-200 bg-gray-900 font-lg rounded-full hover:bg-purple-800 hover:scale-105 focus:outline-none ring-offset-2 focus:ring-2 ring-gray-900">
                            <span>开始探索</span>
                            <span class="ml-2 group-hover:animate-pulse">${ICONS.zap}</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            const q = QUESTIONS[currentState.qIndex];
            const progress = ((currentState.qIndex + 1) / QUESTIONS.length) * 100;

            app.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen p-4 max-w-2xl mx-auto fade-in">
                    <div class="w-full bg-white/95 backdrop-blur rounded-2xl shadow-xl p-8 border-t-8 border-purple-800">
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-8">
                            <div class="bg-purple-800 h-2.5 rounded-full slide-in" style="width: ${progress}%"></div>
                        </div>

                        <div class="flex justify-between items-center mb-6 text-gray-400 text-sm font-mono">
                            <span>QUESTION ${currentState.qIndex + 1} / ${QUESTIONS.length}</span>
                        </div>

                        <h2 class="text-2xl font-bold text-gray-800 mb-10 leading-snug min-h-[4rem]">${q.text}</h2>

                        <div class="space-y-3">
                            ${generateOptions()}
                        </div>
                    </div>
                </div>
            `;
        }

        function generateOptions() {
            const options = [
                { s: 1, l: "完全不同意", c: "hover:bg-green-50 hover:border-green-500" },
                { s: 2, l: "比较不同意", c: "hover:bg-lime-50 hover:border-lime-500" },
                { s: 3, l: "中立", c: "hover:bg-gray-50 hover:border-gray-500" },
                { s: 4, l: "比较同意", c: "hover:bg-orange-50 hover:border-orange-500" },
                { s: 5, l: "完全同意", c: "hover:bg-red-50 hover:border-red-900 hover:text-red-900" }
            ];
            return options.map(opt => `
                <button onclick="handleAnswer(${opt.s})" class="w-full p-4 text-left border-2 border-gray-100 rounded-xl transition-all duration-200 font-medium text-gray-600 ${opt.c} flex justify-between group active:scale-[0.98]">
                    <span>${opt.l}</span>
                </button>
            `).join('');
        }

        function renderResult(resultData) {
            const { scores, character, traitScores } = resultData;
            
            // Generate Tags HTML
            const tagsHtml = character.tags.map(tag => 
                `<span class="inline-block bg-gray-900 text-white text-xs px-3 py-1 rounded-full mr-2 mb-2 font-bold tracking-wider">${tag}</span>`
            ).join('');

            app.innerHTML = `
                <div class="flex flex-col items-center min-h-screen p-4 pb-20 max-w-4xl mx-auto fade-in">
                    
                    <!-- 1. Header Card: Score & Character -->
                    <div class="w-full bg-white rounded-3xl shadow-xl overflow-hidden mb-6 border-b-8 border-purple-900 hover-card">
                        <div class="bg-gray-900 text-white p-8 text-center relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-purple-500 via-transparent to-transparent"></div>
                            <p class="text-purple-300 font-mono mb-2 uppercase tracking-widest text-xs">Dark Factor Score</p>
                            <div class="text-7xl font-black tracking-tighter mb-2 relative z-10">
                                ${scores.dFactor}<span class="text-2xl text-gray-500 font-normal ml-2">/ 5.0</span>
                            </div>
                            <div class="mt-2">${tagsHtml}</div>
                        </div>

                        <div class="p-8 bg-gradient-to-br from-purple-50 to-white">
                            <div class="flex flex-col md:flex-row items-center gap-8">
                                <div class="flex-1 text-center md:text-left">
                                    <div class="flex items-center justify-center md:justify-start gap-2 mb-2 text-purple-900 font-bold uppercase text-xs tracking-wider">
                                        ${ICONS.crown} <span>疯狂动物城 2 角色匹配</span>
                                    </div>
                                    <h2 class="text-3xl font-bold text-gray-900 mb-2">${character.name}</h2>
                                    <p class="text-gray-600 mb-4 text-sm leading-relaxed">${character.desc}</p>
                                    <div class="bg-purple-100 border-l-4 border-purple-800 p-4 italic text-gray-800 text-sm font-medium">
                                        ${character.quote}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Share Button -->
                    <button id="copyBtn" onclick="copyResult('${character.name}', '${scores.dFactor}', '${character.quote}')" class="mb-8 w-full md:w-auto flex items-center justify-center gap-2 px-8 py-4 rounded-full font-bold transition-all shadow-md transform hover:scale-105 active:scale-95 bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:shadow-lg">
                        ${ICONS.share} 一键复制分享结果
                    </button>

                    <!-- 3. Deep Analysis Grid (New Section) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full mb-6">
                        <!-- Light & Shadow -->
                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 hover-card">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2 border-b pb-2">
                                ${ICONS.brain} 光影侧写
                            </h3>
                            <div class="space-y-4">
                                <div class="flex gap-3">
                                    <div class="mt-1 flex-shrink-0">${ICONS.sun}</div>
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-900">天赋光面</h4>
                                        <p class="text-xs text-gray-600 leading-relaxed mt-1">${character.light}</p>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <div class="mt-1 flex-shrink-0">${ICONS.moon}</div>
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-900">阴影盲区</h4>
                                        <p class="text-xs text-gray-600 leading-relaxed mt-1">${character.shadow}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Survival Strategy -->
                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 flex flex-col hover-card">
                             <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2 border-b pb-2">
                                ${ICONS.compass} 生存策略
                            </h3>
                            <div class="flex-1 flex flex-col justify-center">
                                <p class="text-sm text-gray-700 leading-7 font-medium">
                                    ${character.strategy}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Data Visualization Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
                        <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col items-center border border-gray-100 hover-card">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">${ICONS.target} 人格雷达</h3>
                            <div class="w-full h-64 md:h-80 relative">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 hover-card">
                            <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center gap-2">${ICONS.scale} 维度拆解</h3>
                            <div class="space-y-4 max-h-80 overflow-y-auto pr-2 custom-scrollbar">
                                ${generateTraitList(traitScores)}
                            </div>
                        </div>
                    </div>

                    <button onclick="restartQuiz()" class="mt-12 text-gray-400 hover:text-gray-900 underline underline-offset-4 text-sm transition-colors flex items-center gap-2">
                         重新开始测试
                    </button>

                    <div class="mt-8 p-4 bg-yellow-50 text-yellow-800 text-xs rounded-lg max-w-xl text-center border border-yellow-100">
                        <span class="inline-block align-middle mr-1">${ICONS.heartCrack}</span>
                        <strong>声明：</strong> 本测试仅供娱乐与自我探索，不构成专业心理学诊断。
                    </div>
                </div>
            `;
            
            initChart(traitScores);
        }

        function generateTraitList(traitScores) {
            return Object.entries(traitScores).sort(([,a], [,b]) => b - a).map(([trait, score]) => `
                <div class="flex items-center justify-between group p-2 hover:bg-gray-50 rounded-lg transition-colors">
                    <span class="text-sm font-medium text-gray-600">${trait}</span>
                    <div class="flex items-center gap-3 w-1/2">
                        <div class="w-full bg-gray-100 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all duration-500 ${score > 3.5 ? 'bg-red-500' : score > 2.5 ? 'bg-purple-500' : 'bg-green-500'}" style="width: ${(score/5)*100}%"></div>
                        </div>
                        <span class="text-sm font-bold w-6 text-right text-gray-700">${score}</span>
                    </div>
                </div>
            `).join('');
        }

        function startQuiz() {
            currentState.step = 'quiz';
            renderQuiz();
            window.scrollTo(0,0);
        }

        function handleAnswer(score) {
            currentState.answers.push(score);
            currentState.qIndex++;
            if (currentState.qIndex < QUESTIONS.length) {
                renderQuiz();
                window.scrollTo(0,0);
            } else {
                calculateAndShowResult();
            }
        }

        function calculateAndShowResult() {
            const traitScoresRaw = {};
            const traitCounts = {};
            Object.values(TRAITS).forEach(t => { traitScoresRaw[t] = 0; traitCounts[t] = 0; });
            
            currentState.answers.forEach((score, idx) => {
                const tName = TRAITS[QUESTIONS[idx].trait];
                traitScoresRaw[tName] += score;
                traitCounts[tName] += 1;
            });

            const traitScores = {};
            let total = 0;
            Object.keys(traitScoresRaw).forEach(k => {
                const avg = traitScoresRaw[k] / traitCounts[k];
                traitScores[k] = avg.toFixed(1);
                total += avg;
            });

            const dFactor = (total / 9).toFixed(2);
            // Updated character finding logic to support new distribution
            const character = CHARACTERS.find(c => parseFloat(dFactor) >= c.minD) || CHARACTERS[CHARACTERS.length - 1];
            renderResult({ scores: { dFactor }, character, traitScores });
            window.scrollTo(0,0);
        }

        function initChart(traitScores) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const labels = Object.keys(traitScores);
            const data = Object.values(traitScores);
            const avgData = labels.map(() => 2.6);

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '你的 D-Profile',
                            data: data,
                            backgroundColor: 'rgba(88, 28, 135, 0.5)',
                            borderColor: 'rgba(88, 28, 135, 1)',
                            pointBackgroundColor: 'rgba(88, 28, 135, 1)',
                            borderWidth: 2
                        },
                        {
                            label: '人群平均',
                            data: avgData,
                            backgroundColor: 'rgba(156, 163, 175, 0.2)',
                            borderColor: 'rgba(156, 163, 175, 0.6)',
                            borderDash: [5, 5],
                            pointRadius: 0,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(0,0,0,0.1)' },
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            pointLabels: {
                                font: { size: 11, family: "'Noto Sans SC', sans-serif" },
                                color: '#374151'
                            },
                            suggestedMin: 1,
                            suggestedMax: 5,
                            ticks: { display: false }
                        }
                    },
                    plugins: { legend: { position: 'bottom' } },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function copyResult(name, score, quote) {
             // Updated share text to include tags
             const text = `🦊 疯狂动物城2 · 黑暗三角人格测试报告 🐰\n📊 D-Factor指数：${score} / 5.0\n👤 匹配角色：${name}\n-------------------------\n💬 ${quote}\n-------------------------\n🔗 快来测测你的隐藏人格！\n#疯狂动物城2 #心理测试 #黑暗人格 #心灵栖息树`;
             const el = document.createElement('textarea');
             el.value = text;
             document.body.appendChild(el);
             el.select();
             document.execCommand('copy');
             document.body.removeChild(el);
             const btn = document.getElementById('copyBtn');
             const originalText = btn.innerHTML;
             btn.innerHTML = `✅ 已复制文案`;
             btn.classList.add('bg-green-600');
             setTimeout(() => {
                 btn.innerHTML = originalText;
                 btn.classList.remove('bg-green-600');
             }, 2000);
        }

        function restartQuiz() {
            currentState = { step: 'intro', qIndex: 0, answers: [] };
            renderIntro();
        }

        renderIntro();
    </script>
</body>
</html>
